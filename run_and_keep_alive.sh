#! /bin/bash

NOW=$(date +"%m-%d-%Y-%H-%M-%S")
logfile="/NS/twitter-7/work/meslamim/projects/GoogleBias/run.log"

case "$(ps -aux | grep GoogleBias | grep java | grep -v "grep" | wc -l)" in

0)  echo "Restarting BiasScrape:     $NOW" >> $logfile
    java -cp /NS/twitter-7/work/meslamim/projects/GoogleBias/lib/quartz/c3p0-0.9.1.1.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/quartz/log4j-1.2.16.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/quartz/quartz-2.2.2.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/quartz/quartz-jobs-2.2.2.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/quartz/slf4j-api-1.7.7.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/quartz/slf4j-log4j12-1.7.7.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/commons-logging-1.1.1.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/google-api-client-1.20.0.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/google-api-client-android-1.20.0.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/google-api-client-appengine-1.20.0.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/google-api-client-gson-1.20.0.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/google-api-client-jackson2-1.20.0.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/google-api-client-java6-1.20.0.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/google-api-client-servlet-1.20.0.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/google-http-client-1.20.0.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/google-http-client-android-1.20.0.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/google-http-client-appengine-1.20.0.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/google-http-client-gson-1.20.0.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/google-http-client-jackson2-1.20.0.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/google-http-client-jdo-1.20.0.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/google-oauth-client-1.20.0.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/google-oauth-client-appengine-1.20.0.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/google-oauth-client-java6-1.20.0.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/google-oauth-client-jetty-1.20.0.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/google-oauth-client-servlet-1.20.0.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/gson-2.1.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/httpclient-4.0.1.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/httpcore-4.0.1.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/jackson-core-2.1.3.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/jdo2-api-2.3-eb.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/jetty-6.1.26.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/jetty-util-6.1.26.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/jsr305-1.3.9.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/lib/google-customsearch/transaction-api-1.1.jar:/NS/twitter-7/work/meslamim/projects/GoogleBias/dist/GoogleBias.jar googlebias.QueryScheduler > /NS/twitter-7/work/meslamim/projects/GoogleBias/logs/log.$NOW.out 2>&1  &
    ;;
1)  echo "Running BiasScrape:     $NOW" >> $logfile
    ;;
*)  echo "Removed double BiasScrape: $(date)" >> $logfile
    kill $(pidof java | awk '{print $1}')
    ;;
esac
